<div class="row">
	<div class="span2">
		<div class="well">
			<strong>Instructions</strong>
			<p>
				It's Simple! Choose 2 products to view information about each.
			</p>
		</div>
	</div>
	<div class="main-panel span10">
		<%= form_tag "/compare_products", :method => "post" do %>
		<div class="product-select">
			<table class="product-select-table">
				<tr class="product-select-row">
					<td class="criteria-column"></td>
					<td class="product-column"> <%= label_tag :product_1_id %>
					<%= select_tag :product_1_id %> </td>
					<td class="product-column"> <%= label_tag :product_2_id %>
					<%= select_tag :product_2_id %>
					</td>
				</tr>
			</table>
		</div>
		<% end %>
		<table class="compare-table">
			<tr>
				<th class="criteria-column"></th>
				<th class="product-column" id="product_1_header"></th>
				<th class="product-column" id="product_2_header"></th>
			</tr>
			<tr>
				<td><strong>Image: </strong></td>
				<td><div class='center-block' id="product_1_image"></div></td>
				<td><div class='center-block' id="product_2_image"></div></td>
			</tr>
			<tr>
				<td><strong>Type: </strong></td>
				<td id="product_1_product_type"></td>
				<td id="product_2_product_type"></td>
			</tr>
			<tr>
				<td><strong>Price Range: </strong></td>
				<td id="product_1_price_range"></td>
				<td id="product_2_price_range"></td>
			</tr>
			<tr>
				<td><strong>Vendor: </strong></td>
				<td id="product_1_vendor"></td>
				<td id="product_2_vendor"></td>
			</tr>
			<tr>
				<td><strong>Desc: </strong></td>
				<td id="product_1_body_html"></td>
				<td id="product_2_body_html"></td>
			</tr>
		</table>
	</div>
	<!-- main panel -->
</div><!-- row -->

<!-- TODO: Move this to approropiate file later -->
<script type="text/javascript">
	$(function(){
		retrieveProducts();
		
	});
	
	function retrieveProducts() {
		$.ajax({
			url: "/products/index",
			dataType: "json",
			success: function(data, textStatus, jqXHR) {
				ihtml = "";
				jQuery.each(data, function(){
					ihtml += "<option value='" + this.id + "'>" + this.title + "</option>";
				});
				
				$("#product_1_id").html(ihtml);
				$("#product_2_id").html(ihtml);
				retrieveProduct("1");
				retrieveProduct("2");
			},
			error: function(jqXHR, textStatus, errorThrown) {
				alert("Sorry, there was an error trying to retrieve product information.");
			}
		});	
	}
	
	$("#product_1_id").change(function(){
		retrieveProduct("1");
	});
	
	$("#product_2_id").change(function(){
		retrieveProduct("2");
	});
	
	function retrieveProduct(product_number) {
		$.ajax({
			url: "/products/show",
			dataType: "json",
			data: { id : $("#product_" + product_number + "_id").val() },
			success: function(data, textStatus, jqXHR) {
				loadProduct(product_number, data);
			},
			error: function(jqXHR, textStatus, errorThrown) {
				alert("Sorry, there was an error trying to retrieve product information.");
			}
		});
	}
	
	function loadProduct(product_number, data) {
		$("#product_" + product_number + "_header").html(data.title);
		
		if(data.images.length > 0){
			ihtml = "<img src='" + data.images[0].src + "' class='product-image' />";
			$("#product_" + product_number + "_image").html(ihtml);
		}
		
		$("#product_" + product_number + "_product_type").html(data.product_type);
		$("#product_" + product_number + "_price_range").html(data.price_range);
		$("#product_" + product_number + "_vendor").html(data.vendor);
		$("#product_" + product_number + "_body_html").html(data.body_html);
	}
	
</script>
